# 测试用例清单

## 1. 单元测试 (tests/unit/)

### 1.1 Core 模块
| 用例 ID | 用例名称 | 测试目标 | 优先级 |
|---------|---------|---------|--------|
| UC-001 | 节点创建 | 验证 SilkNode 实例化 | P0 |
| UC-002 | 节点启动 | 验证 start() 方法 | P0 |
| UC-003 | 节点停止 | 验证 stop() 方法 | P0 |
| UC-004 | 并发启动防护 | 防止重复启动 | P1 |
| UC-005 | 并发停止防护 | 防止重复停止 | P1 |
| UC-006 | Peer ID 生成 | 验证 ID 格式和唯一性 | P0 |
| UC-007 | 监听地址获取 | 验证地址格式 | P1 |
| UC-008 | 配置加载 | 验证配置合并逻辑 | P1 |

### 1.2 Network 模块
| 用例 ID | 用例名称 | 测试目标 | 优先级 |
|---------|---------|---------|--------|
| UN-001 | 连接建立 | 验证 dial() 方法 | P0 |
| UN-002 | 连接断开 | 验证 hangUp() 方法 | P0 |
| UN-003 | 连接状态查询 | 验证 isConnected() | P1 |
| UN-004 | 连接管理器 | 验证连接池管理 | P1 |
| UN-005 | NAT 类型检测 | 验证 NAT 检测逻辑 | P2 |

### 1.3 Routing 模块
| 用例 ID | 用例名称 | 测试目标 | 优先级 |
|---------|---------|---------|--------|
| UR-001 | DHT 存储 | 验证 dhtPut() | P1 |
| UR-002 | DHT 检索 | 验证 dhtGet() | P1 |
| UR-003 | Peer 发现 | 验证发现机制 | P1 |
| UR-004 | Bootstrap 连接 | 验证引导节点连接 | P2 |

### 1.4 Protocol 模块
| 用例 ID | 用例名称 | 测试目标 | 优先级 |
|---------|---------|---------|--------|
| UP-001 | 消息发送 | 验证 sendMessage() | P0 |
| UP-002 | 消息接收 | 验证消息处理器 | P0 |
| UP-003 | 消息编码 | 验证编码/解码 | P1 |
| UP-004 | ACK 机制 | 验证确认机制 | P2 |

## 2. 集成测试 (tests/integration/)

| 用例 ID | 用例名称 | 测试目标 | 优先级 |
|---------|---------|---------|--------|
| II-001 | 节点间通信 | 端到端消息传递 | P0 |
| II-002 | 多节点网络 | 3+ 节点组网 | P1 |
| II-003 | DHT 集成 | 分布式存储检索 | P1 |
| II-004 | NAT 穿透 | 跨 NAT 通信 | P2 |
| II-005 | Relay 转发 | 中继通信 | P2 |

## 3. E2E 测试 (tests/e2e/)

| 用例 ID | 用例名称 | 测试目标 | 优先级 |
|---------|---------|---------|--------|
| EE-001 | 完整通信流程 | 发送-接收确认 | P0 |
| EE-002 | 网络发现流程 | mDNS + DHT | P1 |
| EE-003 | CLI 操作 | 命令行工具 | P1 |
| EE-004 | 长时间运行 | 稳定性测试 | P2 |

## 4. 环境测试 (tests/environment/)

### 4.1 跨平台测试
| 用例 ID | 用例名称 | 测试目标 | 优先级 |
|---------|---------|---------|--------|
| EP-001 | Linux 兼容性 | Ubuntu/CentOS | P1 |
| EP-002 | macOS 兼容性 | macOS 14+ | P2 |
| EP-003 | Windows 兼容性 | WSL2 | P2 |
| EP-004 | Node.js 18 | 版本兼容 | P1 |
| EP-005 | Node.js 20 | 版本兼容 | P1 |
| EP-006 | Node.js 22 | 版本兼容 | P2 |

### 4.2 环境差异测试
| 用例 ID | 用例名称 | 测试目标 | 优先级 |
|---------|---------|---------|--------|
| EE-001 | UTC 时区 | 时间戳处理 | P2 |
| EE-002 | 多时区切换 | 时区变更处理 | P2 |
| EE-003 | UTF-8 编码 | 多语言支持 | P1 |
| EE-004 | 二进制数据 | 二进制处理 | P1 |
| EE-005 | 特殊字符 | 转义处理 | P2 |

## 5. 性能测试 (tests/performance/)

| 用例 ID | 用例名称 | 测试目标 | 阈值 | 优先级 |
|---------|---------|---------|------|--------|
| PF-001 | 消息延迟 P50 | 单跳延迟 | < 100ms | P0 |
| PF-002 | 消息延迟 P99 | 单跳延迟 | < 200ms | P0 |
| PF-003 | 吞吐量 | msg/s | > 1000 | P0 |
| PF-004 | 连接建立时间 | 首次连接 | < 5s | P1 |
| PF-005 | 并发连接 | 同时连接数 | 100+ | P1 |
| PF-006 | 内存使用 | 峰值内存 | < 200MB | P1 |
| PF-007 | CPU 使用 | 峰值 CPU | < 50% | P2 |
| PF-008 | 内存泄漏 | 长时间运行 | < 1MB/iter | P1 |

## 6. 混沌测试 (tests/chaos/)

| 用例 ID | 用例名称 | 测试目标 | 优先级 |
|---------|---------|---------|--------|
| CF-001 | 网络延迟注入 | 延迟处理 | P1 |
| CF-002 | 连接断开 | 断线重连 | P1 |
| CF-003 | 快速连接循环 | 连接稳定性 | P2 |
| CF-004 | 高负载测试 | 压力处理 | P1 |
| CF-005 | 消息队列溢出 | 队列管理 | P2 |
| CF-006 | 节点恢复 | 故障恢复 | P1 |
| CF-007 | 级联故障 | 故障隔离 | P2 |
| CF-008 | DHT 降级 | 优雅降级 | P2 |
| CF-009 | 网络分区 | 分区处理 | P2 |
| CF-010 | 重复连接失败 | 熔断机制 | P2 |

## 7. 模糊测试 (tests/fuzzing/)

| 用例 ID | 用例名称 | 测试目标 | 优先级 |
|---------|---------|---------|--------|
| FZ-001 | 随机二进制数据 | 数据鲁棒性 | P2 |
| FZ-002 | 极端字符串长度 | 边界处理 | P2 |
| FZ-003 | 特殊字符 | 转义处理 | P2 |
| FZ-004 | 畸形消息头 | 验证容错 | P1 |
| FZ-005 | 畸形消息体 | 验证容错 | P1 |
| FZ-006 | 边缘多地址 | 地址解析 | P2 |
| FZ-007 | 数值边界 | 溢出检查 | P2 |
| FZ-008 | 数组边界 | 容量检查 | P2 |
| FZ-009 | 并发边界 | 竞态检查 | P2 |
| FZ-010 | 协议异常数据 | 协议鲁棒性 | P2 |

## 8. 安全测试 (tests/security/)

| 用例 ID | 用例名称 | 测试目标 | 优先级 |
|---------|---------|---------|--------|
| SV-001 | 版本兼容性 | 版本验证 | P1 |
| SV-002 | 消息类型约束 | 类型检查 | P1 |
| SV-003 | 字段类型验证 | 类型安全 | P1 |
| SV-004 | Peer ID 清理 | 注入防护 | P1 |
| SV-005 | 地址格式验证 | 格式检查 | P1 |
| SV-006 | 连接限制 | DoS 防护 | P1 |
| SV-007 | 大消息处理 | 资源限制 | P1 |
| SV-008 | 身份验证 | ID 验证 | P0 |
| SV-009 | 未授权操作 | 权限检查 | P1 |
| SV-010 | 超时处理 | 超时机制 | P1 |
| SV-011 | 服务降级 | 降级处理 | P2 |
| SV-012 | 速率限制 | 限流机制 | P2 |

## 9. 测试执行矩阵

### 9.1 执行频率
| 测试类型 | 提交时 | PR 时 | 每日 | 每周 | 发布前 |
|---------|-------|-------|------|------|--------|
| 单元测试 | ✅ | ✅ | ✅ | ✅ | ✅ |
| 集成测试 | - | ✅ | ✅ | ✅ | ✅ |
| E2E 测试 | - | - | ✅ | ✅ | ✅ |
| 环境测试 | - | - | - | ✅ | ✅ |
| 性能测试 | - | - | - | ✅ | ✅ |
| 混沌测试 | - | - | - | ✅ | ✅ |
| 模糊测试 | - | - | - | - | ✅ |
| 安全测试 | - | - | - | - | ✅ |

### 9.2 环境要求
| 测试类型 | Node.js | Docker | 网络特权 | 时间 |
|---------|---------|--------|---------|------|
| 单元测试 | 18/20/22 | - | - | 5 min |
| 集成测试 | 20 | - | - | 10 min |
| E2E 测试 | 20 | ✅ | - | 15 min |
| 环境测试 | 18/20/22 | ✅ | - | 30 min |
| 性能测试 | 20 | ✅ | - | 30 min |
| 混沌测试 | 20 | ✅ | NET_ADMIN | 30 min |
| 模糊测试 | 20 | ✅ | - | 60 min |
| 安全测试 | 20 | - | - | 10 min |

## 10. 覆盖率目标

| 模块 | 行覆盖率 | 分支覆盖率 | 函数覆盖率 |
|-----|---------|-----------|-----------|
| Core | 90% | 85% | 95% |
| Network | 85% | 80% | 90% |
| Routing | 85% | 80% | 90% |
| Protocol | 90% | 85% | 95% |
| CLI | 70% | 60% | 80% |
| **总计** | **85%** | **80%** | **90%** |
