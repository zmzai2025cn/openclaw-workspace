# SilkTalk 测试用例 (Test Cases)

**版本**: 0.1.0  
**日期**: 2026-02-22

---

## 用例清单

### L1 环境验证

#### ST-ENV-001: Node.js版本检查
| 项目 | 内容 |
|------|------|
| **目的** | 验证Node.js版本满足最低要求 |
| **前置** | 无 |
| **步骤** | 1. 执行 `node --version` |
| **期望** | 版本 >= 18.0.0 |
| **优先级** | P0 |
| **状态** | ⏳ 待执行 |

#### ST-ENV-002: OpenClaw可用性检查
| 项目 | 内容 |
|------|------|
| **目的** | 验证OpenClaw已安装且可执行 |
| **前置** | Node.js已安装 |
| **步骤** | 1. 执行 `openclaw --version` |
| **期望** | 返回版本号，无错误 |
| **优先级** | P0 |
| **状态** | ⏳ 待执行 |

#### ST-ENV-003: 网络端口检查
| 项目 | 内容 |
|------|------|
| **目的** | 验证目标端口可用 |
| **前置** | 无 |
| **步骤** | 1. 检查端口10001-10010是否被占用 |
| **期望** | 端口未被占用 |
| **优先级** | P0 |
| **状态** | ⏳ 待执行 |

---

### L2 静态分析

#### ST-STA-001: ESLint检查
| 项目 | 内容 |
|------|------|
| **目的** | 验证代码风格合规 |
| **前置** | 代码已编写完成 |
| **步骤** | 1. 执行 `npx eslint src/` |
| **期望** | 0 errors, 0 warnings |
| **优先级** | P0 |
| **状态** | ⏳ 待执行 |

#### ST-STA-002: 语法检查
| 项目 | 内容 |
|------|------|
| **目的** | 验证无语法错误 |
| **前置** | 代码已编写完成 |
| **步骤** | 1. 对所有.js文件执行 `node --check` |
| **期望** | 全部通过 |
| **优先级** | P0 |
| **状态** | ⏳ 待执行 |

---

### L3 单元测试

#### ST-MSG-001: 消息创建
| 项目 | 内容 |
|------|------|
| **目的** | 验证createMessage函数 |
| **前置** | 导入protocol/message.js |
| **步骤** | 1. 调用createMessage('ping', 'A', 'B', {}) |
| **期望** | 返回包含type/id/from/to/timestamp的对象 |
| **优先级** | P0 |
| **状态** | ⏳ 待执行 |

#### ST-MSG-002: 消息编码解码
| 项目 | 内容 |
|------|------|
| **目的** | 验证encode/decode函数 |
| **前置** | 导入protocol/message.js |
| **步骤** | 1. 创建消息 2. encode 3. decode |
| **期望** | 解码后与原消息一致 |
| **优先级** | P0 |
| **状态** | ⏳ 待执行 |

#### ST-MSG-003: 无效消息解码
| 项目 | 内容 |
|------|------|
| **目的** | 验证无效数据处理 |
| **前置** | 导入protocol/message.js |
| **步骤** | 1. decode随机Buffer |
| **期望** | 返回null |
| **优先级** | P1 |
| **状态** | ⏳ 待执行 |

#### ST-BRD-001: OpenClaw桥接执行
| 项目 | 内容 |
|------|------|
| **目的** | 验证execute方法 |
| **前置** | OpenClaw已安装 |
| **步骤** | 1. 创建bridge 2. 执行 '--help' |
| **期望** | 返回success=true, exitCode=0 |
| **优先级** | P0 |
| **状态** | ⏳ 待执行 |

#### ST-BRD-002: 空命令处理
| 项目 | 内容 |
|------|------|
| **目的** | 验证空命令错误处理 |
| **前置** | 导入agent-bridge/bridge.js |
| **步骤** | 1. 调用execute('') |
| **期望** | 抛出'Empty command'错误 |
| **优先级** | P1 |
| **状态** | ⏳ 待执行 |

---

### L4 集成测试

#### ST-NET-001: 节点启动
| 项目 | 内容 |
|------|------|
| **目的** | 验证SilkNode.start() |
| **前置** | 依赖已安装 |
| **步骤** | 1. 创建SilkNode 2. 调用start() |
| **期望** | 返回PeerId，监听端口 |
| **优先级** | P0 |
| **状态** | ⏳ 待执行 |

#### ST-NET-002: 节点停止
| 项目 | 内容 |
|------|------|
| **目的** | 验证SilkNode.stop() |
| **前置** | 节点已启动 |
| **步骤** | 1. 启动节点 2. 调用stop() |
| **期望** | 端口释放，进程结束 |
| **优先级** | P0 |
| **状态** | ⏳ 待执行 |

#### ST-NET-003: mDNS节点发现
| 项目 | 内容 |
|------|------|
| **目的** | 验证局域网自动发现 |
| **前置** | 两台节点在同一网络 |
| **步骤** | 1. 启动节点A 2. 启动节点B |
| **期望** | 节点B日志显示发现节点A |
| **优先级** | P0 |
| **状态** | ⏳ 待执行 |

#### ST-NET-004: 消息发送
| 项目 | 内容 |
|------|------|
| **目的** | 验证节点间消息传输 |
| **前置** | 两节点已连接 |
| **步骤** | 1. 节点A发送ping 2. 节点B接收并回复 |
| **期望** | 节点A收到pong |
| **优先级** | P0 |
| **状态** | ⏳ 待执行 |

#### ST-RT-001: 本地任务执行
| 项目 | 内容 |
|------|------|
| **目的** | 验证route(target='local') |
| **前置** | router已配置localExecutor |
| **步骤** | 1. 调用route('--message "test"', {target:'local'}) |
| **期望** | 返回执行结果，success=true |
| **优先级** | P0 |
| **状态** | ⏳ 待执行 |

#### ST-RT-002: 远程任务委托
| 项目 | 内容 |
|------|------|
| **目的** | 验证route(target='remote') |
| **前置** | 两节点已连接 |
| **步骤** | 1. 节点A委托任务给节点B |
| **期望** | 节点B执行，结果返回节点A |
| **优先级** | P0 |
| **状态** | ⏳ 待执行 |

---

### L5 验收测试

#### ST-ACC-001: 单机双节点完整流程
| 项目 | 内容 |
|------|------|
| **目的** | 验证单机双节点协作 |
| **前置** | 所有依赖已安装 |
| **步骤** | 1. 启动节点A 2. 启动节点B 3. B ping A 4. B delegate任务给A |
| **期望** | 所有步骤成功，结果正确 |
| **优先级** | P0 |
| **状态** | ⏳ 待执行 |

#### ST-ACC-002: 局域网双机完整流程
| 项目 | 内容 |
|------|------|
| **目的** | 验证真实网络环境协作 |
| **前置** | 两台机器在同一局域网 |
| **步骤** | 同ST-ACC-001 |
| **期望** | 所有步骤成功，延迟<100ms |
| **优先级** | P0 |
| **状态** | ⏳ 待执行 |

#### ST-ACC-003: 异常恢复测试
| 项目 | 内容 |
|------|------|
| **目的** | 验证故障恢复能力 |
| **前置** | 两节点已连接 |
| **步骤** | 1. 节点A重启 2. 验证自动重连 |
| **期望** | 节点B自动重新发现节点A |
| **优先级** | P1 |
| **状态** | ⏳ 待执行 |

---

## 测试执行记录

| 用例ID | 执行日期 | 执行人 | 结果 | 缺陷ID |
|--------|----------|--------|------|--------|
| | | | | |

---

**测试负责人**: _______________  
**审核人**: _______________
